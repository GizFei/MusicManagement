<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<link rel="icon" href="static/ico.png">
	<title>Giz Report</title>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="static/default.css">
	<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
	<script src="static/js/highlight.pack.js"></script>
</head>

<body>
	<nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
  		<a class="navbar-brand" href="#">Report</a>
  		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav"
    aria-expanded="false" aria-label="Toggle navigation">
    		<span class="navbar-toggler-icon"></span>
  		</button>
  		<div class="collapse navbar-collapse" id="navbarNav">
    		<ul class="navbar-nav" style="color: black;">
      			<li class="nav-item mx-3 active">
        			<a class="nav-link target" href="#target">目标</a>
      			</li>
      			<li class="nav-item mx-3">
        			<a class="nav-link tech" href="#tech">开发环境</a>
      			</li>
      			<li class="nav-item mx-3">
        			<a class="nav-link keypoint" href="#keypoint">项目要点</a>
      			</li>
      			<li class="nav-item mx-3">
        			<a class="nav-link content" href="#content">内容展示</a>
      			</li>
    		</ul>
  		</div>
	</nav>
	<div class="container" id="target">
		<div class="row py-5">
			<div class="col-6 mx-5">
				<h2 class="py-2">作业一</h2>
				<ul>
					<li class="py-1">建立自己的音乐数据库</li>
					<li class="py-1">要求
						<ul>
							<li class="py-1">多媒体结合：音频(mp3)+图像(png)+文本(txt)</li>
							<li class="py-1">分类：例如分为“Like”和“Dislike”两个类别</li>
							<li class="py-1">歌曲数量&gt;100首</li>
						</ul>
					</li>
				</ul>
			</div>
			<div class="col-4">
				<h2 class="py-2">作业二</h2>
				<ul>
					<li class="py-1">使用作业一中的素林</li>
					<li class="py-1">自动生成类别目录</li>
					<li class="py-1">在一页中浏览数据</li>
					<li class="py-1">尽可能使用HTML5元素</li>
				</ul>
			</div>
		</div>
	</div>
	<div class="container-fluid text-center py-4" style="background-color: #f3f4f5" id="tech">
		<div class="row justify-content-center p-5">
			<div class="card mx-5" style="background: transparent; border: none;">
				<div class="card-img-top" >
					<img src="static/icons/html5.png" height="100px" alt="html5Icon">
				</div>
				<div class="card-body">HTML5
					<span class="fa fa-navicon mx-2" data-toggle="collapse" data-target="#html"></span>
					<div class="card-text collapse" id="html" style="margin-top: 10px;">HTML5</div>
				</div>
			</div>
			<div class="card mx-5" style="background: transparent; border: none;">
				<div class="card-img-top" >
					<img src="static/icons/css3.png" height="100px" alt="css3Icon">
				</div>
				<div class="card-body">CSS3
					<span class="fa fa-navicon mx-2" data-toggle="collapse" data-target="#css"></span>
					<div class="card-text collapse" id="css" style="margin-top: 10px;">Bootstrap 4<br>Font-awesome<br>Wireframe</div>
				</div>
			</div>
			<div class="card mx-5" style="background: transparent; border: none;">
				<div class="card-img-top" >
					<img src="static/icons/js.png" height="100px" alt="jsIcon">
				</div>
				<div class="card-body">Javascript
					<span class="fa fa-navicon mx-2" data-toggle="collapse" data-target="#js"></span>
					<div class="card-text collapse" id="js" style="margin-top: 10px;">jQuery</div>
				</div>
				</div>
			<div class="card mx-5" style="background: transparent; border: none;">
				<div class="card-img-top" >
					<img src="static/icons/python.png" height="100px" alt="pythonIcon">
				</div>
				<div class="card-body">Python
					<span class="fa fa-navicon mx-2" data-toggle="collapse" data-target="#python"></span>
					<div class="card-text collapse" id="python" style="margin-top: 10px;">Flask<br>requests</div>
				</div>
			</div>
		</div>
	</div>
	<div class="container-fluid" id="keypoint" style="padding-bottom: 60px;">
		<div class="row px-5" style="padding-top: 60px;">
			<div class="col-md-6">
				<h4>QQ音乐爬虫<button class="btn btn-info mx-4 btn-sm">展开<span class="">&nbsp;&gt;&gt;</span></button></h4>
				<hr>
				<pre style="height: 400px; overflow: hidden;">
					<code class="python">
class Song:
    """
    用于获取qq音乐单曲的类
    获得qq音乐单曲的songmid的方法，使用网页版qq音乐，进入一首歌的详情页面
    网址类似于"https://y.qq.com/n/yqq/song/00375L600p9sxv.html"
    该网址中的字符串"00375L600p9sxv"即为songmid
    """
    def __init__(self, songmid):
		pass

    def get_song_data(self):
        pass

    def download_song(self, filepath, songname=None):
        """
        下载歌曲源文件
        :param filepath: 保存文件的路径
        :param songname: 歌曲名
        :return:
        """
        pass

    def download_img(self, filepath, imgname=None):
        """
        下载歌曲的封面图片
        :param filepath: 文件保存路径
        :param imgname: 图片名
        :return:
        """
        pass

    def download_lyric(self, filepath, lyricname=None):
        pass

    def download_origin_lyric(self, filepath, lyricname=None):
        """
        下载有时间控制的歌词
        :param filepath:
        :param lyricname:
        :return:
        """
        pass

    def get_song_info(self):
        """
        获取歌曲的关键信息，包括：
        song_mid  song_name  music_url
        :return: song_info -- JSON
        """
        pass


class SongList:
    """
    用于获取qq音乐歌单的类
    获得qq音乐歌单的listid的方法，使用网页版qq音乐，进入一张歌单的详情页面
    网址类似于"https://y.qq.com/n/yqq/playsquare/3628032628.html"
    该网址中的字符串"3628032628"即为listid
    """
    def __init__(self, listid):
        pass
		
    def download_songs_all(self,archive=True, filepath=None):
        """
        下载歌单中的所有歌曲的所有内容，包含歌曲、歌词、歌曲封面
        :param filepath: 保存文件的路径
        :param archive: 是否将一首歌曲的内容归档到一个文件夹中
        :return:
        """
        pass

    def download_songs(self,archive=False, filepath=None):
        """
        下载歌单中的所有歌曲的音乐
        :param filepath: 文件保存的路径
        :param archive: 是否将一首歌曲的内容归档到一个文件夹中
        :return:
        """
        pass

    def download_song_info(self, filepath=None):
        pass
		</code>
				</pre>
			</div>
			<div class="col-md-6">
				<h4>Web服务器搭建(Flask)<button class="btn btn-info mx-4 btn-sm">展开<span class="">&nbsp;&gt;&gt;</span></button></h4>
				<hr>
				<pre style="height: 400px; overflow: hidden;">
					<code class="python">
import flask
from flask import request
from werkzeug.utils import secure_filename
import os
from PIL import Image

UPLOAD_FOLDER = os.path.abspath(os.curdir)
app = flask.Flask(__name__)
app.config['UPLOAD_FOLDER'] = UPLOAD_FOLDER

@app.route('/')
@app.route('/album')
def album():
    return flask.render_template('album.html')

@app.route('/file', methods=['POST', 'GET'])
def upload():
    if request.method == "GET":
        return flask.render_template('file.html', msg="")
    else:
        msg = ""
        if request.files:
            file =  request.files['imgfile']
            filename = secure_filename(file.filename)
            filename = os.path.join(app.config['UPLOAD_FOLDER'], filename)
            file.save(filename)
            img = Image.open(filename)
            nf = os.path.splitext(filename)[0] + ".png"
            img.save(nf)
            os.remove(filename)
            msg = "PNG图片已保存到'{0}'".format(nf)
        else:
            msg = "请选择一个文件"
            
        return flask.render_template('file.html', msg=msg)

@app.route('/&lt;ds&gt;')
def play(ds):
    data = ds.split("_")
    return flask.render_template('play.html', catalog=data[1], serial=data[2])

if __name__ == '__main__':
    app.run(debug=True)
					</code>
				</pre>
			</div>
		</div>
		<h4 class="px-5" style="margin-bottom: 20px; margin-top: 20px;">主页面JS实现</h4>
		<hr class="mx-5">
		<div class="row px-5">
			<div class="col-md-6">
				<h5>页面加载函数<button class="btn btn-info mx-4 btn-sm">展开<span class="">&nbsp;&gt;&gt;</span></button></h5>
				<pre style="height: 400px; overflow: hidden">
					<code class="javascript">
window.onload = function(){
	"use strict";
    getListenBtns();
    showSongs("like", 0);
    $("[data-toggle='popover']").popover();
	// 切换类别
    $(".nav-item").click(function(){
        if(this.id == "like"){
            $("li#like a").addClass("active");
            $("li#dislike a").removeClass("active");
            showSongs("like", 0);
        }else{
            $("li#like a").removeClass("active");
            $("li#dislike a").addClass("active");
            showSongs("dislike", 0);
        }
    });
	// 点击歌曲封面播放
    $(".icon-play").click(function(){
        play_song(parseInt(this.getAttribute("data-index")));
    });
    // 音频事件
    $("audio").each(function(idx, elm){
        elm.addEventListener("ended", function(){
            $(".icon-play").eq(idx).removeClass("fa-pause-circle-o").addClass("fa-play-circle-o");
            elm.removeEventListener("timeupdate");
            $(".song-time")[idx].innerHTML = secToTime(elm.duration);
        });
        elm.addEventListener("playing", function(){
            elm.addEventListener("timeupdate", function(){
                $(".song-time")[idx].innerHTML = secToTime(elm.currentTime);
            });
        });
        elm.addEventListener("loadedmetadata", function(){
            $(".song-time")[idx].innerHTML = secToTime(elm.duration);
        });
    });
    $(".btn-listen").click(function(){
        var url = "/play_" + this.getAttribute("data-song");
        window.location.href = url;
    });
};
					</code>
				</pre>
			</div>
			<div class="col-md-6">
				<h5>动态展示歌曲函数<button class="btn btn-info mx-4 btn-sm">展开<span class="">&nbsp;&gt;&gt;</span></button></h5>
				<pre style="height: 400px; overflow: hidden">
					<code>
var _ss = function(catalog, index){
    var imgs = getImgs();
    var texts = getCardTexts();
    var cards = getCards();
    current_catalog = catalog;
    
    if(catalog == "like" || catalog == "Like"){
            //console.log(data.like);
            // 类别为Like
            var like_data = data.like;
            initPagination(like_data.length);
            currentPage(index);
            for(var i = 0; i &lt; imgs.length; i++){
                var data_idx = current_page * 9 + i;
                /* 加载图片和文字 */
                if(data_idx &gt; like_data.length-1){
                    cards[i].style.display = "none";
                }else{
                    cards[i].style.display = "block";
                    imgs[i].src = like_data[data_idx].imgurl;
                    texts[i].innerHTML = like_data[data_idx].songname;
                    $(".singer-text")[i].innerHTML = like_data[data_idx].singername;
                    $(".song-time")[i].innerHTML = secToTime(like_data[data_idx].songtime);
                    $("audio")[i].src = like_data[data_idx].songurl;
                    $(".icon-play").eq(i).removeClass("fa-pause-circle-o").addClass("fa-play-circle-o");
                    var ds = "like_" + like_data[data_idx].serial;
                    $(".btn-listen")[i].setAttribute("data-song", ds);
                    $("audio")[i].load();
                }
            }
        }else{ // 类别为Dislike
            var dislike_data = data.dislike;
            initPagination(dislike_data.length);
            currentPage(index);
            for(var i = 0; i &lt; imgs.length; i++){
                var data_idx = current_page * 9 + i;
                /* 加载图片和文字 */
                if(data_idx &gt; dislike_data.length-1){
                    cards[i].style.display = "none";
                }else{
                    cards[i].style.display = "block";
                    imgs[i].src = dislike_data[data_idx].imgurl;
                    texts[i].innerHTML = dislike_data[data_idx].songname;
                    $(".singer-text")[i].innerHTML = dislike_data[data_idx].singername;
                    $(".song-time")[i].innerHTML = secToTime(dislike_data[data_idx].songtime);
                    $("audio")[i].src = dislike_data[data_idx].songurl;
                    $(".icon-play").eq(i).removeClass("fa-pause-circle-o").addClass("fa-play-circle-o");
                    var ds = "dislike_" + dislike_data[data_idx].serial;
                    $(".btn-listen")[i].setAttribute("data-song", ds);
                    $("audio")[i].load();
                }
            }
        }
}
					</code>
				</pre>
			</div>
		</div>
		<h4 class="px-5" style="margin-bottom: 20px; margin-top: 20px;">播放页面JS实现</h4>
		<hr class="mx-5">
		<div class="row px-5">
			<div class="col-md-6">
				<h5>页面加载函数<button class="btn btn-info mx-4 btn-sm">展开<span class="">&nbsp;&gt;&gt;</span></button></h5>
				<pre style="height: 400px; overflow: hidden">
					<code>
window.onload = function(){
    current_catalog = $("p#catalog").text();
    current_song = $("p#serial").text();
    $.getJSON('/static/songs/songs_data.json', function(d){
        data = d;
        init_song();
    });
    // 歌曲前一首、后一首切换
    $(".fa-step-forward").click(function(){
        if(parseInt(current_song) == data[current_catalog].length-1){
            confirm("这是最后一首歌。");
        }else{
            current_song = parseInt(current_song)+1;
            init_song();
            play_song();
        }
    });
    $(".fa-play").click(function(){
        play_song();
    });
    $(".fa-step-backward").click(function(){
        if(parseInt(current_song) == 0){
            confirm("这是第一首歌。");
        }else{
            current_song = parseInt(current_song)-1;
            init_song();
            play_song();
        }
    });
    
	// 监听音频播放事件
	/*
		ended: 歌曲结束时自动下一首
		playing：播放时歌词滑动、进度条改变事件
	*/
    audio.addEventListener("ended", function(){
        $(".fa").eq(1).addClass("fa-play").removeClass("fa-pause");
        $(".slider")[0].value = 0;
        $("span#ct")[0].innerHTML = secToTime(0);
        $(".slider").css("background", "#CCC");
        $(".fa-step-forward").click();
    });
    audio.addEventListener("playing", function(){
            audio.addEventListener("timeupdate", function(){
                if(!slider_change){
                    var radio = audio.currentTime / audio.duration;
                    $(".slider")[0].value = parseInt(radio * 400);
                    var color = "linear-gradient(to right, white, white "+ parseInt(radio*100) + "%, #CCC " + parseInt(radio*100) + "%, #CCC)";
                    $(".slider").css("background", color);
                    $("span#ct")[0].innerHTML = secToTime(audio.currentTime);
                    mark_active_lrc(audio.currentTime);
                }
            });
    });
    audio.addEventListener("loadedmetadata", function(){
        $("span#tt")[0].innerHTML = secToTime(audio.duration);
        $("span#ct")[0].innerHTML = secToTime(0);
    });
    
	// 进度条事件
    $(".slider")[0].oninput = function(){
        slider_change = true;
        var radio = parseInt(this.value/400 * 100);
        var color = "linear-gradient(to right, white, white "+ radio + "%, #CCC " + radio + "%, #CCC)";
        $(".slider").css("background", color);
        $("span#ct")[0].innerHTML = secToTime(this.value/400 * audio.duration);
    }

    $(".slider")[0].onchange = function(){
        slider_change = false;
        audio.currentTime = this.value/400 * audio.duration;
        var radio = parseInt(this.value/400 * 100);
        var color = "linear-gradient(to right, white, white "+ radio + "%, #CCC " + radio + "%, #CCC)";
        $(".slider").css("background", color);
        audio.play();
        $(".fa").eq(1).removeClass("fa-play").addClass("fa-pause");
    };
}
					</code>
				</pre>
			</div>
			<div class="col-md-6">
				<h5>歌词加载和变换函数<button class="btn btn-info mx-4 btn-sm">展开<span class="">&nbsp;&gt;&gt;</span></button></h5>
				<pre style="height: 400px; overflow: hidden">
					<code>
// 显示歌词
var init_lyric = function(){
    current_lyric = 0;
    var songname = data[current_catalog][current_song].songname;
    var requestUrl = "static/songs/" + current_catalog + "/" + songname + "/" + songname + ".txt";
    var orgRU = "static/songs/" + current_catalog + "/" + songname + "/" + songname + "_o.txt";
    $.get(requestUrl, function(data){
        data = data.split("\n");
        //console.log(data);
        var ps = []
        for(var i = 0; i &lt; data.length; i++){
            ps.push("&lt;p class='lead my-1'&gt;"+data[i]+"&lt;/p&gt;");
        }
        $("div.lyric")[0].innerHTML = ps.join("");
        $("div.lyric &gt; p").css("transform", "translatey(250px)");
    });
    $.get(orgRU, function(d){
        d = d.split("\n");
        lrc_time = [];
        for(var i = 0; i &lt; d.length; i++){
            var x = d[i].match(/^\[.*\]/)[0];
            lrc_time.push(x);
        }
        //console.log(lrc_time);
    });
}
// 歌词滚动，同时高亮当前歌词
var mark_active_lrc = function( time ){
    var offset = "[offset:0]";
    var idx = 0;
    for(var i = lrc_time.indexOf(offset)+1; i &lt; lrc_time.length; i++){
        lrc_time[i] = lrc_time[i].replace("[", "").replace("]","");
        var min = parseInt(lrc_time[i].split(":")[0]);
        var sec = parseFloat(lrc_time[i].split(":")[1]);
        var t = min * 60 + sec;
        idx = i;
        //console.log(t);
        if(t &gt; time)
            break;
    }
    if(i == lrc_time.length)
        idx = i;
    idx -= 1;
    //console.log(idx);
    if(idx != current_lyric){
        current_lyric = idx;
//        var ty = 250 - idx * 31;
        $("div.lyric &gt; p").removeClass("active");
        $("div.lyric &gt; p").eq(idx).addClass("active");
        $("div.lyric &gt; p").css("transform", "translatey(" + (-idx*37+250) + "px)");
    }
}
					</code>
				</pre>
			</div>
		</div>
	</div>
	<div class="container-fluid bg-light p-5" id="content" style="">
		<div class="row px-3">
            <h4 class="px-3" style="margin-bottom: 20px">界<br>面<br>展<br>示</h4>
			<div class="col-md-5">
				<div id="carouselExampleFade" class="carousel slide carousel-fade" data-ride="carousel">
  				<div class="carousel-inner">
    				<div class="carousel-item active">
						<div class="view">
							<img class="d-block w-100" src="static/icons/album1.png" alt="First slide">
						</div>
						<div class="carousel-caption">
							<p>专辑-1</p>
						</div>
    				</div>
    				<div class="carousel-item">
						<div class="view">
							<img class="d-block w-100" src="static/icons/album2.png" alt="First slide">
						</div>
						<div class="carousel-caption">
							<p>专辑-2</p>
						</div>
    				</div>
    				<div class="carousel-item">
						<div class="view">
							<img class="d-block w-100" src="static/icons/album3.png" alt="First slide">
						</div>
						<div class="carousel-caption">
							<p>专辑-3</p>
						</div>
    				</div>
					<div class="carousel-item">
						<div class="view">
							<img class="d-block w-100" src="static/icons/play1.png" alt="First slide">
						</div>
						<div class="carousel-caption">
							<p>播放</p>
						</div>
    				</div>
					<div class="carousel-item">
						<div class="view">
							<img class="d-block w-100" src="static/icons/file1.png" alt="First slide">
						</div>
						<div class="carousel-caption">
							<p>图片转换</p>
						</div>
    				</div>
  				</div>
				<div class="controls-top text-center" style="position: absolute; left: 30%;right: 30% ; bottom: 30px; font-size: 25px;">
    				<a class="btn-floating mx-4" href="#carouselExampleFade" data-slide="prev"><i class="fa fa-chevron-left"></i></a>
    				<a class="btn-floating mx-4" href="#carouselExampleFade" data-slide="next"><i class="fa fa-chevron-right"></i></a>
  				</div>
			</div>
			</div>
            <h4 class="px-3" style="margin-bottom: 20px; margin-left: 30px;">视<br>频<br>演<br>示</h4>
            <div class="col-md-5">
                <video src="static/videos/show.mp4" class="video-fluid" style="width: 100%" controls></video>
            </div>
		</div>
	</div>
	<script>hljs.initHighlightingOnLoad();</script>
    <script>
        $("li.nav-item").each(function(idx, e){
            e.onclick = function(){
                $("li.nav-item").removeClass("active");
                $("li.nav-item").eq(idx).addClass("active");
            }
        });
        $(".btn-info").click(function(){
            if(this.parentElement.parentElement.getElementsByTagName("pre")[0].style.overflow == "hidden"){
                this.innerHTML = "收起<span class=''>&nbsp;&lt;&lt;</span>";
                this.parentElement.parentElement.getElementsByTagName("pre")[0].style.overflow = "scroll";
            }else{
                this.innerHTML = "展开<span class=''>&nbsp;&gt;&gt;</span>";
                this.parentElement.parentElement.getElementsByTagName("pre")[0].style.overflow = "hidden";
            }
        })
    </script>
</body>

</html>
























